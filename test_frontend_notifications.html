<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试教师通知功能</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>教师通知功能测试</h1>
    <button onclick="testLogin()">1. 测试登录</button>
    <button onclick="testNotifications()">2. 测试通知</button>
    <div id="result"></div>

    <script>
        let authToken = '';
        
        async function testLogin() {
            try {
                document.getElementById('result').innerHTML = '正在登录...';
                const response = await axios.post('http://localhost:3000/api/auth/login', {
                    email: 'teacher1763449748933@example.com',
                    password: 'password123'
                });
                
                if (response.data.success) {
                    authToken = response.data.data.token;
                    document.getElementById('result').innerHTML = '✅ 登录成功！Token已获取';
                    console.log('Token:', authToken);
                } else {
                    document.getElementById('result').innerHTML = '❌ 登录失败：' + response.data.error;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = '❌ 登录错误：' + error.message;
                console.error('登录错误:', error);
            }
        }
        
        async function testNotifications() {
            if (!authToken) {
                document.getElementById('result').innerHTML = '请先登录！';
                return;
            }
            
            try {
                document.getElementById('result').innerHTML = '正在获取通知...';
                
                // 测试待审批通知
                const pendingResponse = await axios.get('http://localhost:3000/api/teacher/notifications/pending', {
                    headers: { Authorization: `Bearer ${authToken}` }
                });
                
                // 测试已通过通知
                const approvedResponse = await axios.get('http://localhost:3000/api/teacher/notifications/approved', {
                    headers: { Authorization: `Bearer ${authToken}` }
                });
                
                // 测试已驳回通知
                const rejectedResponse = await axios.get('http://localhost:3000/api/teacher/notifications/rejected', {
                    headers: { Authorization: `Bearer ${authToken}` }
                });
                
                let result = '<h3>通知测试结果：</h3>';
                result += '<p>✅ 待审批通知: ' + pendingResponse.data.data.length + ' 条</p>';
                result += '<p>✅ 已通过通知: ' + approvedResponse.data.data.length + ' 条</p>';
                result += '<p>✅ 已驳回通知: ' + rejectedResponse.data.data.length + ' 条</p>';
                
                result += '<h4>待审批通知详情：</h4>';
                if (pendingResponse.data.data.length > 0) {
                    pendingResponse.data.data.forEach(notif => {
                        result += `<div style="border: 1px solid #ccc; margin: 5px; padding: 5px;">
                            <strong>${notif.title}</strong><br>
                            学生: ${notif.student_name}<br>
                            提交时间: ${new Date(notif.created_at).toLocaleString()}
                        </div>`;
                    });
                }
                
                document.getElementById('result').innerHTML = result;
                
            } catch (error) {
                document.getElementById('result').innerHTML = '❌ 获取通知失败：' + error.message;
                console.error('获取通知错误:', error);
            }
        }
    </script>
</body>
</html>