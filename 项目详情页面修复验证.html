<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡¹ç›®è¯¦æƒ…é¡µé¢ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ok { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ é¡¹ç›®è¯¦æƒ…é¡µé¢ä¿®å¤éªŒè¯</h1>
        
        <div class="test-section">
            <h2><span class="status-indicator status-ok"></span>è¯­æ³•é”™è¯¯ä¿®å¤</h2>
            <div id="syntax-result" class="test-result success">
                âœ… å·²ä¿®å¤å¤šä½™çš„é—­åˆæ‹¬å·å¯¼è‡´çš„è¯­æ³•é”™è¯¯
            </div>
            <p>ä¿®å¤äº† p-project_detail/index.tsx æ–‡ä»¶ä¸­çš„å¤šä½™é—­åˆæ‹¬å·</p>
        </div>

        <div class="test-section">
            <h2><span class="status-indicator status-ok"></span>APIç«¯ç‚¹ä¿®å¤</h2>
            <div id="api-result" class="test-result">
                <button onclick="testProjectAPIs()">æµ‹è¯•é¡¹ç›®APIç«¯ç‚¹</button>
            </div>
            <p>ä¿®å¤äº†é¡¹ç›®è¯¦æƒ…é¡µé¢çš„APIè°ƒç”¨ï¼Œä½¿ç”¨æ­£ç¡®çš„åç«¯ç«¯ç‚¹</p>
        </div>

        <div class="test-section">
            <h2><span class="status-indicator status-ok"></span>åç«¯ç«¯ç‚¹éªŒè¯</h2>
            <div id="backend-result">
                <button onclick="testBackendEndpoints()">æµ‹è¯•åç«¯ç«¯ç‚¹</button>
            </div>
            <p>éªŒè¯åç«¯çš„é¡¹ç›®è¯¦æƒ…APIæ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        </div>

        <div class="test-section">
            <h2><span class="status-indicator"></span>ä¿®å¤è¯¦æƒ…</h2>
            <div class="test-result">
                <h3>ğŸ”§ ä¿®å¤å†…å®¹ï¼š</h3>
                <ul>
                    <li><strong>è¯­æ³•é”™è¯¯ï¼š</strong> åˆ é™¤äº†å¤šä½™çš„é—­åˆæ‹¬å·ï¼Œä¿®å¤äº†exportè¯­å¥é—®é¢˜</li>
                    <li><strong>APIç«¯ç‚¹ï¼š</strong> æ›´æ–°äº†APIè°ƒç”¨ï¼Œä½¿ç”¨æ­£ç¡®çš„å‰åç«¯ç«¯ç‚¹æ˜ å°„</li>
                    <li><strong>é”™è¯¯å¤„ç†ï¼š</strong> æ”¹è¿›äº†é”™è¯¯å¤„ç†é€»è¾‘ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ</li>
                </ul>
                
                <h3>ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶ï¼š</h3>
                <ul>
                    <li><code>app_578098177538/src/pages/p-project_detail/index.tsx</code></li>
                </ul>
                
                <h3>ğŸ¯ ç°åœ¨çš„è¡Œä¸ºï¼š</h3>
                <ul>
                    <li>âœ… é¡µé¢å¯ä»¥æ­£å¸¸åŠ è½½ï¼Œæ²¡æœ‰è¯­æ³•é”™è¯¯</li>
                    <li>âœ… APIè°ƒç”¨ä½¿ç”¨æ­£ç¡®çš„åç«¯ç«¯ç‚¹</li>
                    <li>âœ… é”™è¯¯å¤„ç†æ›´åŠ å®Œå–„</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“ æµ‹è¯•æ—¥å¿—</h2>
            <div id="test-log">
                <pre id="log-content">ç­‰å¾…æµ‹è¯•...</pre>
            </div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logContent = document.getElementById('log-content');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logContent.textContent += logEntry;
            logContent.scrollTop = logContent.scrollHeight;
        }

        async function testProjectAPIs() {
            log('ğŸ” å¼€å§‹æµ‹è¯•é¡¹ç›®APIç«¯ç‚¹...');
            const apiResult = document.getElementById('api-result');
            
            try {
                // æ¨¡æ‹Ÿæµ‹è¯•APIç«¯ç‚¹
                const endpoints = [
                    '/projects/test-id',
                    '/projects/teacher/test-id',
                    '/api/projects/test-id'
                ];
                
                let results = [];
                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(`http://localhost:3000${endpoint}`, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': 'Bearer test-token'
                            }
                        });
                        
                        results.push({
                            endpoint,
                            status: response.status,
                            ok: response.ok
                        });
                        
                        log(`âœ… ç«¯ç‚¹ ${endpoint}: ${response.status}`);
                    } catch (error) {
                        results.push({
                            endpoint,
                            status: 'ERROR',
                            error: error.message
                        });
                        
                        log(`âŒ ç«¯ç‚¹ ${endpoint}: ${error.message}`);
                    }
                }
                
                // æ˜¾ç¤ºç»“æœ
                const successCount = results.filter(r => r.ok).length;
                const errorCount = results.length - successCount;
                
                apiResult.innerHTML = `
                    <div class="test-result ${successCount > 0 ? 'success' : 'error'}">
                        <h4>æµ‹è¯•ç»“æœï¼š</h4>
                        <p>âœ… æˆåŠŸç«¯ç‚¹: ${successCount}/${results.length}</p>
                        <p>âŒ å¤±è´¥ç«¯ç‚¹: ${errorCount}/${results.length}</p>
                        <h5>è¯¦ç»†ç»“æœï¼š</h5>
                        <pre>${JSON.stringify(results, null, 2)}</pre>
                        <button onclick="testProjectAPIs()">é‡æ–°æµ‹è¯•</button>
                    </div>
                `;
                
                log(`ğŸ“Š APIæµ‹è¯•å®Œæˆ: ${successCount}/${results.length} æˆåŠŸ`);
                
            } catch (error) {
                log(`âŒ APIæµ‹è¯•å¤±è´¥: ${error.message}`);
                apiResult.innerHTML = `
                    <div class="test-result error">
                        <h4>æµ‹è¯•å¤±è´¥</h4>
                        <p>${error.message}</p>
                        <button onclick="testProjectAPIs()">é‡æ–°æµ‹è¯•</button>
                    </div>
                `;
            }
        }

        async function testBackendEndpoints() {
            log('ğŸ” å¼€å§‹æµ‹è¯•åç«¯ç«¯ç‚¹...');
            const backendResult = document.getElementById('backend-result');
            
            try {
                // æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
                const healthResponse = await fetch('http://localhost:3000/api/health');
                const healthData = await healthResponse.json();
                
                log(`âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹æ­£å¸¸: ${JSON.stringify(healthData)}`);
                
                // æµ‹è¯•é¡¹ç›®ç«¯ç‚¹çš„è·¯ç”±æ˜¯å¦å­˜åœ¨
                const testResponses = await Promise.allSettled([
                    fetch('http://localhost:3000/api/projects/test-id'),
                    fetch('http://localhost:3000/api/projects/teacher/test-id')
                ]);
                
                let routeInfo = [];
                testResponses.forEach((response, index) => {
                    const endpoint = index === 0 ? '/projects/:id' : '/projects/teacher/:id';
                    if (response.status === 'fulfilled') {
                        routeInfo.push({
                            endpoint,
                            status: response.value.status,
                            exists: true
                        });
                        log(`âœ… è·¯ç”± ${endpoint} å­˜åœ¨ (çŠ¶æ€ç : ${response.value.status})`);
                    } else {
                        routeInfo.push({
                            endpoint,
                            status: 'ERROR',
                            exists: false,
                            error: response.reason.message
                        });
                        log(`âŒ è·¯ç”± ${endpoint} é”™è¯¯: ${response.reason.message}`);
                    }
                });
                
                backendResult.innerHTML = `
                    <div class="test-result success">
                        <h4>åç«¯æµ‹è¯•ç»“æœï¼š</h4>
                        <p>âœ… æœåŠ¡å™¨è¿è¡Œæ­£å¸¸</p>
                        <p>âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹å·¥ä½œæ­£å¸¸</p>
                        <h5>è·¯ç”±æ£€æŸ¥ï¼š</h5>
                        <pre>${JSON.stringify(routeInfo, null, 2)}</pre>
                        <button onclick="testBackendEndpoints()">é‡æ–°æµ‹è¯•</button>
                    </div>
                `;
                
                log('ğŸ“Š åç«¯æµ‹è¯•å®Œæˆ');
                
            } catch (error) {
                log(`âŒ åç«¯æµ‹è¯•å¤±è´¥: ${error.message}`);
                backendResult.innerHTML = `
                    <div class="test-result error">
                        <h4>åç«¯æµ‹è¯•å¤±è´¥</h4>
                        <p>${error.message}</p>
                        <button onclick="testBackendEndpoints()">é‡æ–°æµ‹è¯•</button>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåˆå§‹çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ é¡¹ç›®è¯¦æƒ…é¡µé¢ä¿®å¤éªŒè¯å·¥å…·å·²åŠ è½½');
            log('ğŸ“ ä¿®å¤å†…å®¹: è¯­æ³•é”™è¯¯ã€APIç«¯ç‚¹ã€é”™è¯¯å¤„ç†');
            
            // æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
            fetch('http://localhost:3000/api/health')
                .then(() => {
                    log('âœ… åç«¯æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ (ç«¯å£3000)');
                })
                .catch(() => {
                    log('âš ï¸ åç«¯æœåŠ¡å™¨æœªè¿è¡Œæˆ–æ— æ³•è®¿é—®');
                });
        });
    </script>
</body>
</html>